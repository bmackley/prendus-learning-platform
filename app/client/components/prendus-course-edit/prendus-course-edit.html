<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-shared-styles.html">
<link rel="import" href="../../bower_components/paper-date-picker/paper-date-picker.html">
<link rel="import" href="../../bower_components/redux-store-element/redux-store.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-char-counter.html">
<link rel="import" href="../../bower_components/Sortable/Sortable.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../prendus-concept-container-edit/prendus-concept-container-edit.html">
<link rel="import" href="../prendus-notification/prendus-notification.html">
<script src="../../bower_components/moment/min/moment-with-locales.min.js"></script>

<dom-module id="prendus-course-edit">
  <template>
    <style>

      :host {
        display: block;
      }

      #course-container {
        width: 100%;
      }

      #course-content {
        display: flex;
        flex-direction: column;
        padding: 20px;
      }

      #course-content > * + * {
        margin-top: 20px;
      }

      #collaborators-button {
        align-self: flex-end;
      }

      #concept-list {
        border: solid lightgrey 1px;
      }

      .menu-content {
        padding: 20px;
      }

      .course-concept {
        width: 100%;
      }

      .concept-container {
        display: flex;
      }

      .concept-container + .concept-container {
        border-top: solid lightgrey 1px;
      }

      .concept-edit-container {
        flex-grow: 1;
      }

      #course-title {
        --paper-input-container-input: {
          font-size: 48px;
        };
      }
      #course-description {
        --paper-input-container-input: {
          font-size: 24px;
        };
      }

    </style>

    <redux-store action="[[action]]" on-statechange="mapStateToThis"></redux-store>
    <app-route route="[[route]]" pattern="/edit/:courseId" data="{{data}}"></app-route>

    <prendus-notification success-message="[[successMessage]]"></prendus-notification>
    <prendus-notification error-message="[[errorMessage]]"></prendus-notification>

    <paper-card id="course-container">
      <div id="course-content" class="card-content">
        <template is="dom-if" if="[[username]]">
          <paper-button id="collaborators-button" noink on-tap="openCollaboratorsModal">Collaborators</paper-button>
          <prendus-collaborator-modal id="collaborators-modal" uid="[[uid]]" course-id="[[courseId]]" course></prendus-collaborator-modal>
          <paper-input name="title" label="Course Title" id="course-title" value="[[currentCourse.title]]" on-change="attributeChanged"></paper-input>
          <paper-input name="description" id="course-description" label="Course Description" label="Input label" value="[[currentCourse.description]]" on-change="attributeChanged"></paper-input>
          <paper-input name="tags" id="course-tags" label="Course tags" label="Input label" value="[[currentCourse.tagNames]]"></paper-input>
          <h1>[[currentCourse.title]] Concepts</h1>
          <template is="dom-if" if="[[!courseConceptsLength]]">
            <p>Click the plus button to begin adding concepts to the Course.</p>
          </template>
          <sortable-js id="concept-list" on-sort="sortableEnded">
            <template is="dom-repeat" items="[[courseConcepts]]">
              <div class="concept-container">
                <prendus-concept-container-edit class="concept-edit-container" concept-id="[[item.id]]"></prendus-concept-container-edit>
              </div>
            </template>
          </sortable-js>
        </template>

        <template is="dom-if" if="[[!username]]">
          <p> You are not signed in.  Please sign in to access this page </p>
        </template>
        <paper-dialog id = "addDialog" modal>
          <div>
            <!-- Look up Iron keys to change this -->
            <form is="iron-form">
              <h2>Add a Concept to the Course</h2>
              <paper-input name="name" label="Concept Name" id ="conceptFormName" required auto-validate></paper-input>
              <paper-button dialog-dismiss>Cancel</paper-button>
              <paper-button on-tap="addConceptFormDone">Done</paper-button>
            </form>
          </div>
          <div class="buttons">
          </div>
        </paper-dialog>
        <paper-dialog id = "deleteConfirm" modal>
            <!-- Look up Iron keys to change this -->
            <form is="iron-form">
              <h1 style="color: red">Confirm Delete </h1>
              <p>Are you sure that you want to delete this concept?
              <paper-button dialog-dismiss>No</paper-button>
              <paper-button id = "confirmeDelete" on-tap="completeDelete">Yes</paper-button>
            </form>
        </paper-dialog>
        <paper-fab icon = "add" title = "Add Concept" tooltip="Add Concept" on-tap="addConcept"></paper-fab>
      </div>
    </paper-card>

  </template>

</dom-module>
