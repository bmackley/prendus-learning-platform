<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-shared-styles.html">
<link rel="import" href="../../bower_components/paper-date-picker/paper-date-picker.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/redux-store-element/redux-store.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-char-counter.html">
<link rel="import" href="../../bower_components/Sortable/Sortable.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/prendus-paper-tags-input/prendus-paper-tags-input.html">
<link rel="import" href="../prendus-notification/prendus-notification.html">
<link rel="import" href="../prendus-concept-container/prendus-concept-container.html">
<link rel="import" href="../prendus-concept-container-edit/prendus-concept-container-edit.html">
<link rel="import" href="../prendus-concept-new-concept/prendus-concept-new-concept.html">

<dom-module id="prendus-course-view">

	<style include="color-styles"></style>
  <style>

    * {
      margin: 0;
    }

    :host {
      display: block;
    }

    #course-container {
      width: 100%;
    }

    #course-content {
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

    #course-content > * + * {
      margin-top: 20px;
    }

    .edit-button {
      align-self: flex-start;
    }

    #collaborators-button {
      align-self: flex-end;
    }

		#due-date {
			position: inherit;
			display: flex;
		}

    #concept-list {
      border: solid lightgrey 1px;
    }

    .tag {
      background-color: var(--light-primary-color);
      border-radius: 20px;
      padding: 10px;
      margin: 5px;
    }

    .menu-content {
      padding: 20px;
    }

    .course-concept {
      width: 100%;
    }

    .concept-container {
      display: flex;
    }

    .concept-container + .concept-container {
      border-top: solid lightgrey 1px;
    }

    .concept-edit-container {
      flex-grow: 1;
    }

		.sortable-ghost {
			background-color: #ccc;
		}

    #course-title {
      --paper-input-container-input: {
        font-size: 48px;
      };
    }

    #course-description {
      --paper-input-container-input: {
        font-size: 24px;
      };
    }

		.add-concept-button {
			background-color: var(--prendus-primary-color);
			color: white;
		}

		paper-dropdown-menu, paper-listbox {
    	width: 250px;
	  }

  </style>
  <template>
    <redux-store action="[[action]]" on-statechange="mapStateToThis"></redux-store>
    <app-route route="[[route]]" pattern="/view/:courseId" data="{{data}}"></app-route>
    <prendus-notification success-message="[[successMessage]]" error-message="[[errorMessage]]"></prendus-notification>
    <paper-card id="course-container">
      <div id="course-content" class="card-content">
        <template is="dom-if" if="[[username]]">
          <!-- COLLABORATORS -->
          <template is="dom-if" if="[[hasEditAccess]]">
            <!-- <iron-icon id="lti-button" icon="social:share" on-tap="getLTILinks"></iron-icon> -->
            <!-- <paper-tooltip for="lti-button" offset="0" animation-delay="300">Get LTI Links</paper-tooltip> -->
            <paper-button id="collaborators-button" noink on-tap="openCollaboratorsModal">Collaborators</paper-button>
          </template>
          <prendus-collaborator-modal id="collaborators-modal" uid="[[uid]]" course-id="[[courseId]]" course></prendus-collaborator-modal>
          <!-- TITLE -->
          <h1 hidden$="[[editingTitle]]">[[currentCourse.title]]</h1>
          <paper-input hidden$="[[!editingTitle]]" name="title" label="Course Title" id="course-title" value="[[currentCourse.title]]" maxlength="50" on-change="attributeChanged"></paper-input>
          <template is="dom-if" if="[[hasEditAccess]]">
            <paper-button class="edit-button" raised noink on-tap="toggleEditTitle">[[getTitleButtonText(editingTitle)]]</paper-button>
          </template>
          <!-- DESCRIPTION -->
          <h3 hidden="[[editingDescription]]">[[currentCourse.description]]</h3>
          <paper-input hidden="[[!editingDescription]]" name="description" id="course-description" label="Course Description" value="[[currentCourse.description]]" maxlength="100" on-change="attributeChanged"></paper-input>
          <template is="dom-if" if="[[hasEditAccess]]">
            <paper-button class="edit-button" raised noink on-tap="toggleEditDescription">[[getDescriptionButtonText(editingDescription)]]</paper-button>
          </template>
					<!-- SUBJECT -->
					<paper-dropdown-menu label="Subject">
						<paper-listbox class="dropdown-content">
							<template is="dom-repeat" items="[[subjects]]">
								<paper-item on-tap="subjectChange">[[item]]</paper-item>
							</template>
					  </paper-listbox>
					</paper-dropdown-menu>

          <!-- DUE DATE -->
          <template is="dom-if" if="[[hasEditAccess]]">
            <br>
            <h3>Last day of course</h3>
            <paper-date-picker id="due-date" date="[[displayDate(currentCourse.dueDate)]]" on-click="dueDateChanged"></paper-date-picker>
          </template>
          <!-- TAGS -->
          <h3 hidden$="[[!showTagsTitle(currentCourse, hasEditAccess)]]">Tags</h3>
          <template is="dom-if" if="[[showTagsView(currentCourse, hasEditAccess)]]">
            <div id="tags-container">
              <template is="dom-repeat" items="[[currentCourse.tags]]">
                <span class="tag">[[item.name]]</span>
              </template>
            </div>
          </template>
          <template is="dom-if" if="[[hasEditAccess]]">
            <prendus-paper-tags-input placeholder="Delete tags or add new ones" duplicate-error-message="Tag cannot be a duplicate" id="tags" tags="[[courseTagNames]]" on-remove="onRemove" on-add="onAdd"></prendus-paper-tags-input>
          </template>
          <!-- CONCEPTS -->
          <h2>[[currentCourse.title]] Concepts</h2>
          <template is="dom-if" if="[[!hasEditAccess]]">
            <template is="dom-repeat" items="[[courseConcepts]]">
              <div class="concept-container">
                <prendus-concept-container class="concept-edit-container" concept-id="[[item.id]]" course-id="[[data.courseId]]"></prendus-concept-container>
              </div>
            </template>
          </template>
          <template is="dom-if" if="[[hasEditAccess]]">
            <template is="dom-if" if="[[!courseConceptsLength]]">
              <p>Click the plus button to begin adding concepts to the Course.</p>
            </template>
            <sortable-js id="concept-list" animation="200" on-sort="sortableEnded">
              <template is="dom-repeat" items="[[courseConcepts]]">
                <div class="concept-container">
                  <prendus-concept-container-edit class="concept-edit-container" concept-id="[[item.id]]"></prendus-concept-container-edit>
                </div>
              </template>
            </sortable-js>
            <paper-button class="add-concept-button" on-tap="addConcept">Add Concept</paper-button>
          </template>
        </template>

        <template is="dom-if" if="[[!username]]">
          <p> You are not signed in.  Please sign in to access this page </p>
        </template>
        <prendus-concept-new-concept id="addConceptDialog" uid="[[uid]]" course-id="[[courseId]]" course-concepts="[[courseConcepts]]"></prendus-concept-new-concept>
        <paper-dialog id="confirm-delete" with-backdrop>
          <form is="iron-form">
            <h1 style="color: red">Confirm Delete </h1>
            <p>Are you sure that you want to delete this concept?
            <paper-button dialog-dismiss>No</paper-button>
            <paper-button on-tap="completeDelete">Yes</paper-button>
          </form>
        </paper-dialog>
      </div>
    </paper-card>

  </template>

  <script src="prendus-course-view.ts"></script>
</dom-module>
